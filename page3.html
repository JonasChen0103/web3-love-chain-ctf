<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web3.0戀鏈資訊營 - 密碼學CTF最終關卡</title>
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="stylesheet" href="styles/components.css" />
  <link rel="stylesheet" href="styles/grid.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="theme-crypto">
<div class="container">
  <h1>🎯 最後一封信</h1>

  <!-- 進度指示器 -->
  <div class="progress-indicator">
    <div class="progress-step completed" data-level="1">1</div>
    <div class="progress-step completed" data-level="2">2</div>
    <div class="progress-step active" data-level="3">3</div>
  </div>

  <div class="section" id="access-denied" style="display: none;">
    <h2>⚠️ 存取受限</h2>
    <p>請依序完成前面的關卡才能進入最終挑戰。</p>
    <div class="navigation-section">
      <a href="index.html" class="nav-btn">回到第一關</a>
    </div>
  </div>

  <div class="section" id="main-content">
    <h2>最後的謎題</h2>
    <p>能來到這裡的你，真的很厲害！我必須承認，我開始認真地想要認識你了。💌</p>
    <p>其實從小到大，我就很喜歡那種需要動腦筋的遊戲。小時候我跟我姐姐會互相設計謎題，最有趣的是那種需要兩樣東西組合才能解開的謎題。</p>
    <p>還記得我在第一關送給你的小禮物嗎？那塊看起來很普通的起司，其實藏著解開這最後謎題的關鍵...</p>

    <div class="hint">
      <strong>💡 線索：</strong>
      有時候看似簡單的圖案，其實隱藏著重要的資訊。仔細觀察每個細節，你會發現規律的。
      <br><small>想想看，什麼東西能讓隱藏的文字顯現出來？</small>
    </div>

    <div class="letter-grid-container">
      <h3>🔤 字母對照表</h3>
      <div class="letter-grid">
        <div class="grid-row">
          <span class="grid-cell">7</span><span class="grid-cell">I</span><span class="grid-cell">N</span><span class="grid-cell">U</span>
          <span class="grid-cell">R</span><span class="grid-cell">%</span><span class="grid-cell">H</span><span class="grid-cell">O</span>
        </div>
        <div class="grid-row">
          <span class="grid-cell">S</span><span class="grid-cell">P</span><span class="grid-cell">Q</span><span class="grid-cell">K</span>
          <span class="grid-cell">!</span><span class="grid-cell">K</span><span class="grid-cell">:</span><span class="grid-cell">Q</span>
        </div>
        <div class="grid-row">
          <span class="grid-cell">E</span><span class="grid-cell">C</span><span class="grid-cell">B</span><span class="grid-cell">T</span>
          <span class="grid-cell">2</span><span class="grid-cell">$</span><span class="grid-cell">L</span><span class="grid-cell">G</span>
        </div>
        <div class="grid-row">
          <span class="grid-cell">W</span><span class="grid-cell">M</span><span class="grid-cell">6</span><span class="grid-cell">F</span>
          <span class="grid-cell">A</span><span class="grid-cell">0</span><span class="grid-cell">#</span><span class="grid-cell">C</span>
        </div>
        <div class="grid-row">
          <span class="grid-cell">2</span><span class="grid-cell">8</span><span class="grid-cell">D</span><span class="grid-cell">Y</span>
          <span class="grid-cell">V</span><span class="grid-cell">X</span><span class="grid-cell">!</span><span class="grid-cell">Z</span>
        </div>
        <div class="grid-row">
          <span class="grid-cell">3</span><span class="grid-cell">R</span><span class="grid-cell">5</span><span class="grid-cell">J</span>
          <span class="grid-cell">H</span><span class="grid-cell">W</span><span class="grid-cell">1</span><span class="grid-cell">P</span>
        </div>
      </div>
    </div>

    <div class="input-group">
      <textarea id="final-input" placeholder="透過圖像和對照表找到的訊息..." class="cipher-input"></textarea>
      <div class="button-group">
        <button onclick="Level3.checkAnswer()" id="final-submit" class="primary-btn">提交最終答案</button>
        <button onclick="Level3.showHint()" class="secondary-btn">需要提示？</button>
        <button onclick="Level3.showGridHelper()" class="tools-btn">網格助手</button>
      </div>
    </div>

    <div id="final-result" class="result-display"></div>
  </div>

  <!-- 網格助手 -->
  <div class="section hidden" id="grid-helper">
    <h2>🔍 視覺密碼學助手</h2>
    <p>點擊下方字母來模擬起司洞洞效果：</p>

    <div class="interactive-grid-container">
      <div id="interactive-grid" class="interactive-grid">
        <!-- 將由JavaScript生成 -->
      </div>
    </div>

    <div class="grid-controls">
      <button onclick="Level3.clearSelection()" class="secondary-btn">清除選擇</button>
      <button onclick="Level3.showSelected()" class="primary-btn">填入選中字母</button>
    </div>

    <div class="selected-letters-display">
      <strong>選中的字母：</strong>
      <span id="letter-sequence" class="letter-sequence">(尚未選擇)</span>
    </div>
  </div>

  <!-- 成功頁面 -->
  <div class="section hidden success-section" id="success-section">
    <h2>🎉 挑戰完成！</h2>
    <p><strong>恭喜你成功解開了所有密碼！</strong></p>

    <div class="success-message">
      <div class="success-content">
        <h3>🎯 最終任務完成！</h3>
        <p>恭喜你解開了所有的謎題！現在去找到我的 Instagram 帳號，追蹤我吧～我會知道是誰成功破解了我設計的遊戲！</p>
        <p>💕 期待在那裡看到你的訊息！</p>
        <small>（你解出的答案就是我的 IG 帳號格式）</small>
      </div>

      <div class="instagram-section">
        <a href="#" target="_blank" class="instagram-btn glow-btn" id="instagram-link">
          📱 前往 Instagram
        </a>
      </div>
    </div>
  </div>

  <!-- 導航區域 -->
  <div class="navigation-section">
    <a href="page2.html" class="nav-btn secondary">← 回到第二關</a>
    <button onclick="GameController.resetGame()" class="nav-btn danger">重新開始遊戲</button>
  </div>
</div>

<!-- JavaScript -->
<script src="scripts/config.js"></script>
<script src="scripts/crypto.js"></script>
<script src="scripts/security.js"></script>
<script src="scripts/storage.js"></script>
<script src="scripts/ui.js"></script>
<script src="scripts/level3.js"></script>
<script src="scripts/game.js"></script>
</body>
</html>